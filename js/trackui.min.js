/* evtrack -- UI module */
var TrackUI={settings:{postServer:"http://my.server.org/save.script",postInterval:10},uid:0,info:[],record:function(e){for(var h in this.settings){if(e.hasOwnProperty(h)&&e[h]!==null){this.settings[h]=e[h]}}var c=["mousedown","mouseup","mousemove","click","scroll","mousewheel"],g=["touchstart","touchend","touchmove"],d=["keydown","keyup","keypress"],a=["blur","focus","resize"],f;for(f=0;f<c.length;++f){TrackLib.Events.add(document,c[f],TrackUI.mouseHandler)}for(f=0;f<g.length;++f){TrackLib.Events.add(document,g[f],TrackUI.touchHandler)}for(f=0;f<d.length;++f){TrackLib.Events.add(document,d[f],TrackUI.keyHandler)}for(f=0;f<a.length;++f){TrackLib.Events.add(window,a[f],TrackUI.winHandler)}if(document.attachEvent){TrackLib.Events.add(document.body,"focusout",TrackUI.winHandler);TrackLib.Events.add(document.body,"focusin",TrackUI.winHandler)}setTimeout(TrackUI.initNewData,e.postInterval*1000);var b=(typeof window.onbeforeunload==="function")?"beforeunload":"unload";TrackLib.Events.add(window,b,TrackUI.flush)},initNewData:function(){var c=TrackLib.Dimension.getWindowSize(),b=TrackLib.Dimension.getDocumentSize(),a="url="+escape(window.location.href);a+="&screenw="+screen.width;a+="&screenh="+screen.height;a+="&winw="+c.width;a+="&winh="+c.height;a+="&docw="+b.width;a+="&doch="+b.height;a+="&info="+TrackUI.info;a+="&action=init";TrackUI.send({postdata:a,callback:TrackUI.setUserId});TrackUI.info=[]},setUserId:function(a){TrackUI.uid=parseInt(a);if(TrackUI.uid){setInterval(TrackUI.appendData,TrackUI.settings.postInterval*1000)}},appendData:function(){var a="uid="+TrackUI.uid;a+="&info="+TrackUI.info;a+="&action=append";TrackUI.send({postdata:a});TrackUI.info=[]},send:function(a){a.url=TrackUI.settings.postServer;a.async=false;TrackLib.XHR.sendAjaxRequest(a)},mouseHandler:function(a){TrackUI.eventHandler(a)},keyHandler:function(a){TrackUI.eventHandler(a)},winHandler:function(a){TrackUI.eventHandler(a)},eventHandler:function(c){c=TrackLib.Events.fix(c);var b=TrackUI.getMousePos(c),a=TrackUI.findElement(c);TrackUI.fillInfo(b.x,b.y,c.type,a)},touchHandler:function(a){a=TrackLib.Events.fix(a);var b=a.touches[0]||a.targetTouches[0]||a.changedTouches[0];if(b){b.type=a.type;TrackUI.eventHandler(b)}},getMousePos:function(b){b=TrackLib.Events.fix(b);var a=0,c=0;if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}if(!a||a<0){a=0}if(!c||c<0){c=0}return{x:a,y:c}},findElement:function(a){a=TrackLib.Events.fix(a);return TrackLib.XPath.getXPath(a.target)},fillInfo:function(a,d,c,b){TrackUI.info.push(new Date().getTime()+" "+a+" "+d+" "+c+" "+b)},flush:function(a){if(TrackUI.uid){TrackUI.appendData()}else{TrackUI.initNewData()}}};